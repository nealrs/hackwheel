var hackathons = [
 {
  "name": "Summer Jam", 
  "fullname": "Summer Jam Hackathon Series",
  "prizes": "tons of stuff including Apple watches, drones, and DO credits" ,
  "link": "http://summerjam.challengepost.com",
  "img": "https://img.evbuc.com/https%3A%2F%2Fimg.evbuc.com%2Fhttp%253A%252F%252Fcdn.evbuc.com%252Fimages%252F13891735%252F61810770721%252F1%252Foriginal.jpg%3Frect%3D0%252C587%252C3264%252C1632%26s%3D668a07f3d5db6762d1546308a432ccf5?w=600&s=54c68655c414bc80b17c425e245d2dfe",
  "deadline": "July 20 & July 27",
  "tagline": "8 great online hackathons about maps, selfies, IoT, and more!",
 },
 {
  "name": "InnovateNYP", 
  "fullname":"Innovate NYP Open Challenge",
  "prizes": "$25,000",
  "link": "http://innovatenyp-challenge2015.challengepost.com/",
  "img": "http://challengepost-s3-challengepost.netdna-ssl.com/photos/production/challenge_thumbnails/000/264/650/datas/large.png",
  "deadline": "July 25",
  "tagline": "Create innovative technology solutions to help enhance the hospital experience for patients and care providers at NewYork-Presbyterian!",
 },
 {
  "name": "Nexmo Beta", 
  "fullname":"Nexmo Beta Developer Contest",
  "prizes": "Amazon Echo + WeMo Light Switch + Philips Hue Kit",
  "link": "http://nexmo-july15.challengepost.com/",
  "img": "http://challengepost-s3-challengepost.netdna-ssl.com/photos/production/challenge_thumbnails/000/273/765/datas/large.jpg",
  "deadline": "July 31",
  "tagline": "Be the first to take Nexmo's new beta Number Insight APIs for a spin. ",
 },
 {
  "name": "Hack Your Ride", 
  "fullname":"Hack your Ride - Apps for Cars Developer Challenge",
  "prizes": "$15,692",
  "link": "http://hack-your-ride.challengepost.com/",
  "img": "http://challengepost-s3-challengepost.netdna-ssl.com/photos/production/challenge_thumbnails/000/264/608/datas/large.jpg",
  "deadline": "August 10",
  "tagline": "Can you develop the \"killer app\" for connected cars? If so, you could win an app accelerator package to take your app from demo to download.",
 },
 
 {
  "name": "Spiceworks", 
  "fullname":"Spiceworks Breakthrough App Challenge",
  "prizes": "$65,000",
  "link": "http://spiceworks.challengepost.com/",
  "img": "http://challengepost-s3-challengepost.netdna-ssl.com/photos/production/challenge_thumbnails/000/243/480/datas/large.png",
  "deadline": "August 14",
  "tagline": "Build the next breakthrough app on the world's largest IT platform. Win $$$. Get recognized. Get visibility. Find your market. Grow your career.",
 },
 {
  "name": "Context.IO", 
  "fullname": "Context.IO App Challenge",
  "prizes": "$125,000",
  "link": "http://contextio.challengepost.com/",
  "img": "http://challengepost-s3-challengepost.netdna-ssl.com/photos/production/challenge_thumbnails/000/261/140/datas/large.gif",
  "deadline": "September 1",
  "tagline": "Build a consumer app using email data from your users' inboxes and put it in front of VC/startup heavyweights Fred Wilson, Brad Feld, David Cohen, Matt Blumberg, Joshua Baer.",
 },
 {
  "name": "Sao Paulo", 
  "fullname": "Ford's Sao Paulo Global Mobility Challenge",
  "prizes": "$20,000",
  "link": "http://saopaulo-global.challengepost.com/",
  "img": "http://challengepost-s3-challengepost.netdna-ssl.com/photos/production/challenge_thumbnails/000/264/661/datas/large.png",
  "deadline": "September 8",
  "tagline": "Ford is looking to the innovators of the world (that's you!) to help create software solutions for what's been nicknamed \"the city of 19 million traffic jams.\"",
 },
 {
  "name": "Alohar Mobile", 
  "fullname": "Alohar Mobile App Challenge",
  "prizes": "$40,000",
  "link": "http://aloharmobile.challengepost.com/",
  "img": "http://challengepost-s3-challengepost.netdna-ssl.com/photos/production/challenge_thumbnails/000/274/565/datas/large.png",
  "deadline": "September 15",
  "tagline": "Build context-aware apps that automatically understand where the user is and can trigger certain events",
 },
 
 {
  "name": "Hack the Block", 
  "fullname": "Hack the Block with Rackspace & ObjectRocket",
  "prizes": "$25,000",
  "link": "http://hacktheblock.challengepost.com/",
  "img": "http://challengepost-s3-challengepost.netdna-ssl.com/photos/production/challenge_thumbnails/000/268/996/datas/large.gif",
  "deadline": "October 20",
  "tagline": "Build apps with impact! Create a mobile app for YOUR community using ObjectRocket by Rackspace's MongoDB and Redis platforms. Build. Help. Win.",
 },
 {
  "name": "KPCB Fellows", 
  "fullname": "KPCB Fellows Challenge",
  "prizes": "$1,000 + interviews for 2016 Fellows Program",
  "link": "http://kpcbfellowschallenge.challengepost.com/",
  "img": "http://challengepost-s3-challengepost.netdna-ssl.com/photos/production/challenge_thumbnails/000/261/400/datas/large.jpg",
  "deadline": "August 31",
  "tagline": "Hack for good and help six nonprofits use technology to tackle global challenges.",
 },
 {
  "name": "Send Anywhere", 
  "fullname": "Send Anywhere's Blue Airplane Hack",
  "prizes": "$8,000",
  "link": "http://send-anywhere.challengepost.com/",
  "img": "http://challengepost-s3-challengepost.netdna-ssl.com/photos/production/challenge_thumbnails/000/269/685/datas/large.png",
  "deadline": "August 19",
  "tagline": "Build apps with Send Anywhere's new API. You can share files without ans sign ups or logins and you can use it with Android, desktop, web, and iOS.",
 },
 {
  "name": "Hack My Ride", 
  "fullname": "Hack My Ride 2.0",
  "prizes": "$30,000",
  "link": "http://hackmyride2.challengepost.com/",
  "img": "http://challengepost-s3-challengepost.netdna-ssl.com/photos/production/challenge_thumbnails/000/252/420/datas/large.jpg",
  "deadline": "September 17",
  "tagline": "Use VTA data & build new apps to transform how we get around in Silicon Valley.",
 }
 
];

$(document).ready(function() {
    var isDragging = false;
	var previousDragX, previousDragY, currentDragX, currentDragY, clickedX, clickedY;
	var arcAngle = 0;
	var changedAngle = 0;

	rouletteWheel.draw();

	if(params.length > 0){
		initLocation();
		proceed();
	}

	$('a.settings').click(function() {
		toggleSettings();
	});
	$('#settings-search').click(function() {
		searchUserDefined();
	});
	$('#location-option-current').click(function() {
		$('.select-localisation').hide();
		$('.search-localisation').show();
		initLocation();
	});
	$('#location-option-find').click(function() {		
		$('.select-localisation').hide();
		$('.panel-map').show();
		initialize();
	});
	$('#localistion-failure').click(function() {
		proceed();
	});
	$('#select-location').click(function() {
		$(this).html('<i class="fa fa-refresh fa-spin"></i>');
		params.lat = $('#latBox').val();
		params.long = $('#lngBox').val();
		initLocation();
	});
	$('#spin').click(function() {
		if(!rouletteWheel.retIsSpinning()) {
			rouletteWheel.spin(true);
		}
	});
	$('#wheel').mousedown(function(e) {
		clickedX = e.pageX;
		clickedY = e.pageY;
		//set up the first instance of previous drag
		previousDragX = e.pageX;
		previousDragY = e.pageY;
		isDragging = true;
	});
	$('#wheel').mousemove(function(e) {
		if(isDragging && !rouletteWheel.retIsSpinning()) {
			currentDragX = e.pageX;
			currentDragY = e.pageY;

			//finding the movement from the last drag
			changedAngle = Math.atan2(currentDragY - $('#spin').position().top, currentDragX - $('#spin').position().left);
			changedAngle -= Math.atan2(previousDragY - $('#spin').position().top, previousDragX - $('#spin').position().left);

			//recalculating the arc from when the mouse was firsted click -- used to indicate a 'spin'
			arcAngle = Math.atan2(currentDragY - $('#spin').position().top, currentDragX - $('#spin').position().left);
			arcAngle -= Math.atan2(clickedY - $('#spin').position().top, clickedX - $('#spin').position().left);


			//add whatever the angle has changed by from the last movement of the mouse
			rouletteWheel.addToStartAngle(changedAngle);
			rouletteWheel.draw(true);

			//update the previous with the current coordinate of the mouse
			previousDragY = currentDragY;
			previousDragX = currentDragX;
		} 
	});
	$('#wheel').mouseup(function(e) {
		if((arcAngle >= 0.5) && !rouletteWheel.retIsSpinning() && changedAngle > 0) { // a minimum delta of rad = 0.5 required to drag around the wheel to count as a 'spin' 
			rouletteWheel.spin(true);
		} else if((arcAngle < -4) && !rouletteWheel.retIsSpinning() && changedAngle > 0) {
			rouletteWheel.spin(true);
		} else if((arcAngle <= -0.5) && !rouletteWheel.retIsSpinning() && changedAngle < 0) {
			rouletteWheel.spin(false);
		} else if((arcAngle > 4) && !rouletteWheel.retIsSpinning() && changedAngle < 0) {
			rouletteWheel.spin(false);
		} 
		isDragging = false;
	});
	$('#wheel').mouseout(function(e) {
		isDragging = false;
	});
	$('#confetti-world').click(function() {
		proceed();
	});
	$('#shareLink').click(function() {
		$(this).select();
	});
	$('#new-location').click(function() {
		reset();
		params.lat = undefined;
		params.long = undefined;
		blurBackground();
		$('.select-localisation').show();
	});
	
	// Start confetti - will still be hidden
	window.init();
});

function proceed() {
	$('.select-localisation').hide();
	$('.localisation').hide();
	$('.panel-map').hide();
	$('.result').hide();
	
	//Clear google maps
	$('#search').val('');
	$('#select-location').text('Select Location');
	
	//Clear confetti canvas
	var confetti = document.getElementById('confetti-world');
	confetti.width = confetti.width;
	$('#confetti-world').hide();
	
    unblurBackground();
    generateShareLink();
}

function blurBackground() {
	$('.unblur').removeClass('unblur').addClass('blur');
}

function unblurBackground() {
	$('.blur').removeClass('blur').addClass('unblur');
}

function toggleSettings() {
	$('.settings').toggleClass('settings-open');
	$('.clickme').hide();
}

function closeSettings() {
	if($('.settings-open')[0] !== undefined) {
		$('.settings').removeClass('settings-open');
	}
}

function generateShareLink() {
	$('#shareLink').val(createURL());
}

function createURL() {
	var url = window.location.origin + window.location.pathname,
		params = {
			lat: $('#latitude').val(),
			long: $('#longitude').val(),
			radius: $('#radius').val(),
			type: $('.settings input[type=radio]:checked').val(),
			maxplaces: $('#maxPlaces').val()
		};
	
	return url + '?' + $.param(params);
}
